\section{$\Disj$ over product distributions}

Мы докажем почти совпадающие нижнюю и верхнюю оценки.

\begin{theorem}
    Существует такое разпределение $\mu$, что $\DCC_{\varepsilon}^{\mu}(\Disj_n) = \Omega(\sqrt{n})$.
\end{theorem}

\begin{proof}
    На высоком уровне идея доказательства следующая. У $\Disj$ существует маленькое покрытие
    $0$-прямоугольниками, но все $1$-прямоугольники в покрытии <<должны быть>> довольно маленькими. Так
    что мы сосредоточимся на анализе <<почти полностью единичных>> прямоугольников.

    При этом для, например, равномерного распределения на входах мера единиц очень маленькая, так как два
    случайных подмножества $[n]$ пересекаются с большой вероятностью. Давайте рассмотрим меру $\mu$,
    равномерную на подмножествах размера $\sqrt{n}$, т.е., каждое из таких подмножеств выпадает игроку с
    вероятностью $\binom{n}{\sqrt{n}}^{-1}$.

    Для этой меры $\mu(f^{-1}(1)) = \Pr[x \cap y = \emptyset] \approx (\frac{n -
        \sqrt{n}}{n})^{\sqrt{n}} \approx \frac{1}{e}$.

    Для доказательства нам понадобится следующая лемма, которую докажем чуть позже.
    \begin{lemma}
        $R \coloneqq S \times T$, $R$~--- прямоугольник, $\varepsilon$-близкий к $1$-прямоугольнику
        (т.е., доля нулей не более $\varepsilon$). Тогда либо $|S| \leq 2^{-c\sqrt{n}}
        {{n}\choose{\sqrt{n}}}$, либо $|T| \leq 2^{-c\sqrt{n}} {{n}\choose{\sqrt{n}}}$.
    \end{lemma}

    Заметим, что из леммы сразу следует доказательство теоремы. Мы не можем покрыть слишком большую долю
    единиц прямоугольниками, не $\varepsilon$-близкими к полностью единичным, иначе ошибка будет слишком
    большая --- скажем, если мы покроем долю $\frac{1}{8}$, то получим ошибку протокола не менее
    $\frac{\varepsilon}{8e}$, что плохо, если хотим ошибку меньше.

    Тогда как минимум константную долю меры единиц нужно покрыть $\varepsilon$-несбалансированными
    прямоугольниками. Пусть $R = S \times T$ --- самый большой по мере $\mu$ прямоугольник,
    $\varepsilon$-близкий к $1$-прямоугольнику. Н.у.о. $|T| \leq |S|$.

    $\mu(R) = \sum \mu(s,t) = (\sum \lambda(s))(\sum \rho(t)) \leq 1 \cdot
    \frac{|T|}{{{n}\choose{\sqrt{n}}}} \leq 2^{-c\sqrt{n}}$.

    Тогда нам понадобится порядка $2^{c\sqrt{n}}$ таких прямоугольников.
\end{proof}


Теперь докажем лемму.

\begin{proof}
    Предположим, что $|S| > 2^{-c\sqrt{n}} \binom{n}{\sqrt{n}}$, иначе всё уже хорошо.

    Покажем, что тогда $T$ достаточно маленькое. Выберем $S' \subseteq S : \forall s \in S' :
    \Pr\limits_{y \in  T}[\Disj(x, y) = 1] \geq 1 - 2\varepsilon$. Это означает, что мы выбираем те
    строки, в которых доля единиц хотя бы $1 - 2\varepsilon$. Так как $S \times T$ близок к
    $1$-прямоугольнику, $|S'| \ge \frac{|S|}{2}$.

    Выберем последовательность строк $S'' = (x_1, \ldots, x_{\sqrt{n}/3})$ из $S'$ таких, что $|\bigcup
    x_i| \geq \frac{n}{6}$. Добьёмся этого тем, что на каждом шаге будет выбирать такое $x_{i + 1}$, что
    $|x_{i + 1} \setminus \bigcup\limits_{j \leq i} x_j| \geq \frac{\sqrt{n}}{2}$.

    $x_1$ --- любой элемент. Далее выбираем жадно. Почему каждый раз сможем найти подходящий элемент?

    Пусть уже выбрали $(x_1, \dots, x_k)$. Тогда $|\bigcup x_i| \le k \sqrt{n} \leq n / 3$.

    Сколько бывает множеств, которые нам не подходят? Как минимум $\sqrt{n}/2$ элементов плохого
    множества лежат в $|\bigcup x_i|$.

    $\sum_{i = \sqrt{n}/2}^{\sqrt{n}}{{n/3}\choose{i}} {{2n/3}\choose{\sqrt{n} - i}} \leq n
    {{n/3}\choose{\sqrt{n}/2}} {{2n/3}\choose{\sqrt{n}/2}} \approx
    2^{-c\sqrt{n}}{{n}\choose{\sqrt{n}}}$.

    Как получить последнее равенство? Источники утверждают, что по формуле Стирлинга, но для тех, кто,
    как и я, не умеет считать, предлагаю вероятностный метод. Давайте выберем случайное подмножество
    ${{n}\choose{\sqrt{n}}}$. При этом у нас зафиксировано некоторое разделение $[n]$ на два множества
    размера $n/3$ и $2n/3$, и нам подходят только те сочетания, которые берут поровну элементов из них. В
    среднем же мы берём из множества размера $n/3$ около трети элементов выборки. Применим оценки Чернова
    и получим, что вероятность получить подходящее множество порядка $2^{-c\sqrt{n}}$, что и
    требовалось.

    После того, как выбрали последовательность $S'' = (x_1, \ldots, x_{\sqrt{n}/3})$, выберем в $T'
    \subseteq T$ такие $y$, что они пересекаются не более чем с $4\varepsilon$-долей $x_i \in S''$.

    Из определений следует, что $|T'| \geq \frac{|T|}{2}$. Тогда $\forall y \in T' :  \exists (1 -
    4\varepsilon) \frac{\sqrt{n}}{3} \text{ множеств } x_{i_j} \in S'' : y \subseteq [n] \backslash
    \bigcup_j x_{i_j}$.

    $|[n] \setminus \bigcup\limits_j x_{i_j}| \le n - (1 - 4\varepsilon)\frac{n}{6} \leq \frac{8n}{9}$
    при достаточно малом $\varepsilon$.Тогда разных $y$ в $T'$ может быть не более
    ${{\sqrt{n}/3}\choose{4\varepsilon\sqrt{n}/3}}{{8n/9}\choose{\sqrt{n}}} <
    2^{-c\sqrt{n}}{{n}\choose{\sqrt{n}}}$ (тоже можно получить с использованием формулы
    Стирлинга/вероятностного метода).
\end{proof}

\begin{theorem}
    Для любого product distribution $\mu = \lambda \times \rho$ $\DCC^{\mu}(\Disj) = \bigO{\sqrt{n}
        \log{n}}$.
\end{theorem}

\begin{proof}
    Несмотря на то, что в определении distributional communication complexity фигурируют
    детерминированные протоколы, мы построим вероятностный. У него будет некоторая маленькая ошибка
    $\varepsilon$ и матожидание количества пересланных бит $\bigO{\sqrt{n}\log{n}}$. Из этого можно
    легко получить детерминированный протокол, ещё чуть-чуть понизив ошибку, разрешив пересылать
    чуть-чуть побольше бит, чем матожидание и, наконец, зафиксировав <<самые лучшие>> случайные биты.

    Итак, построим вероятностный протокол. У Алисы множество $x \sim \lambda$, у Боба множество $y \sim
    \rho$, нужно понять, пересекаются ли они.

    \begin{enumerate}
        \item Если $|x| \leq \sqrt{n}$, Алиса пересылает $x$ Бобу, тратя $\sqrt{n}\log{n}$ бит, Боб
            присылает ответ на задачу.
        \item Иначе $|x| > \sqrt{n}$. Боб проверяет, что $\varepsilon_y = \Pr\limits_{x \sim \lambda} [x
            \cap y = \emptyset | |x| > \sqrt{n}] \leq \frac{\varepsilon}{\sqrt{n}}$. Если да, отвечает,
            что множества пересекаются. Иначе с помощью публичных случайных бит генерируется
            последовательность $X_1, \ldots, X_i, \ldots$, где $X_i \sim \lambda|_{> \sqrt{n}}$. Боб
            посылает Алисе первый такой номер $j$, что $X_j$ не пересекается с $y$.
        \item $x coloneqq x \setminus X_j$, $U \coloneqq U \setminus X_j$, $\lambda \coloneqq \lambda|_{x
            \subseteq U}$. После этого игроки возвращаются к первому шагу.
    \end{enumerate}

    В этом протоколе не более $\sqrt{n}$ фаз, так как на каждой фазе вселенная уменьшается на $\sqrt{n}$
    элементов. Ошибка случается только на втором шаге с $\varepsilon_y$, применяя union bound, получаем,
    что суммарно за все шаги ошибка не больше $\sqrt{n} \cdot \frac{\varepsilon}{\sqrt{n}} =
    \varepsilon$.

    Матожидание длины номера множества, который пересылает Боб на каждой фазе:
    $c_i = \Exp\limits_{R, X \sim \lambda, y \sim \rho} [\bigO{\log{j}}] \le
    \bigO{\Exp\limits_y[\log{\Exp\limits_{X, R}[j]}]}$.
    
    $\Exp[j] = \frac{1}{\Pr[X \cap y = \emptyset \mid |X| > \sqrt{n}]} = \frac{1}{\varepsilon_y} \le
    \frac{\sqrt{n}}{\varepsilon}$.

    Итого $c_i = \bigO{\log{n} + \log{\frac{1}{\varepsilon}}}$.
\end{proof}